$(document).ready(function(){var e=document.getElementById("gameFrame"),t=e.getContext("2d");e.width=.9*document.getElementById("desc").offsetWidth-.9*document.getElementById("desc").offsetWidth%20,e.height=.4*window.innerHeight-.4*window.innerHeight%10,e.style.width=e.width.toString()+"px",e.style.height=e.height.toString()+"px";var a,i={x:0,y:0},o=(new Image,new Image),d=new Image,r=new Image,h=new Image,n=0,s=0,c=0;d.src="http://www.clker.com/cliparts/u/J/w/w/T/H/checkered-flag.svg",o.src="img/Rock.png",h.src="img/blood.png",window.onload=function(){console.log("background"),$("#desc canvas").css("background-size",e.style.width+" "+e.style.height),drawGrid(t),t.drawImage(o,8*e.width/20,4*e.height/10,e.width/20,e.height/10),t.drawImage(o,12*e.width/20,2*e.height/10,e.width/20,e.height/10),t.drawImage(d,19*e.width/20,9*e.height/10,e.width/20,e.height/10)},drawGrid=function(t){console.log("drawgrid"),t.beginPath();for(var a=.5;a<e.width;a+=e.width/20)t.moveTo(a,0),t.lineTo(a,e.height);for(var i=.5;i<e.height;i+=e.height/10)t.moveTo(0,i),t.lineTo(e.width,i);t.strokeStyle="#fff",t.stroke(),t.closePath()},$("body").on("keydown",".command",function(d){if(console.log("Called"),13==d.which){d.preventDefault();var l=document.getElementsByName("command")[0].value;if($("#arrow").replaceWith('<div id = "arrow"> >></div>'),$(".terminal").append("<span>"+l+"</span><br/>"),0==c)$(".terminal").append('<div class = "terminal-text">Hello, '+l+'. In this game, we want to move our character from the starting point to finish line. We start with creating the character first. Type <b>var = object.new()</b> in the terminal. Put the URL of the sprite that you want to use inside the bracket, surrounded by "".</div>'),$("#player").append(l),c++;else if(1==c){var g=document.getElementsByName("command")[0].value,m=/(\w+)(\s*)=(\s*)object.new\(\"(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?\"\)/;if(g.match(m)){console.log(m);var w=m.exec(g);$(".terminal").append('<div class = "terminal-text">Object named '+w[1]+" created. Image is taken from "+w[5]+"."+w[6]+"<br/>Now let's make the object move. Type (name of variable).move(x,y) and see the object teleport. Move the object to the finish line, and avoid the stones.</div>"),r.src=w[4]+w[5]+"."+w[6]+w[7],r.onload=function(){t.drawImage(r,n*e.width/20,s*e.height/10,e.width/20,e.height/10)},a=w[1],c++}else $(".terminal").append('<div class = "error-text">Syntax Error. Did you create an actual object?</div>')}else if(2==c){var g=document.getElementsByName("command")[0].value,m=new RegExp(a+"(\\s*).(\\s*)move(\\s*)\\((\\s*)(-|)(\\d+)(\\s*),(\\s*)(-|)(\\d+)(\\s*)\\)");if(console.log(m),console.log(g),g.match(m)){var w=m.exec(g);console.log("canvas"),t.save(),t.clearRect(i.x*e.width/20,i.y*e.height/10,e.width/20,e.height/10),n=w[5]+w[6],s=w[9]+w[10],i.x+=parseInt(n),i.y+=parseInt(s),12==i.x&&2==i.y||8==i.x&&4==i.y?(t.clearRect(i.x*e.width/20,i.y*e.height/10,e.width/20,e.height/10),t.drawImage(h,i.x*e.width/20,i.y*e.height/10,e.width/16,e.height/6),t.drawImage(o,i.x*e.width/20,i.y*e.height/10,e.width/20,e.height/10),drawGrid(t),alert("You're squished by the rock. Game over!"),c++,$(".terminal").append('<div class = "error-text">GAME OVER.</div>')):19==i.x&&9==i.y?(t.clearRect(i.x*e.width/20,i.y*e.height/10,e.width/20,e.height/10),t.drawImage(r,i.x*e.width/20,i.y*e.height/10,e.width/20,e.height/10),drawGrid(t),alert("You've reached the destination. You won!!"),c++):(t.drawImage(r,i.x*e.width/20,i.y*e.height/10,e.width/20,e.height/10),drawGrid(t)),t.restore(),$("#position").html("Position: ("+i.x+", "+i.y+")")}else $(".terminal").append('<div class = "error-text">Syntax Error. Did you create an actual object?</div>')}else $(".terminal").append('<div class = "error-text">GAME OVER. To restart playing, please reload the page.</div>');$(".command").remove(),$(".terminal").append('<div id = "arrow"> >>&nbsp;</div><input class = "command" type = "text" name = "command" autofocus="autofocus"/>')}})});